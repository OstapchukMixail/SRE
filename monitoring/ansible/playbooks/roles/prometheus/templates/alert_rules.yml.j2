groups:
  - name: golden_signals_alerts
    rules:
      # 1. Alert: Высокая задержка (Latency)
      - alert: HighLatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: High latency detected
          description: The 95th percentile latency is {{ $value }}s, which exceeds 1s.

      # 2. Alert: Высокий процент ошибок (Error rate)
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: High error rate detected
          description: Error rate of 5xx responses is {{ $value }} requests/sec, which exceeds 0.1.

      # 3. Alert: Высокая скорость запросов (Traffic)
      - alert: HighRequestRate
        expr: sum(rate(http_requests_total[5m])) > 1000
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: High request rate detected
          description: Request rate is {{ $value }} requests/sec, which exceeds 1000.

      # 4. Alert: Высокая загрузка CPU (Saturation)
      - alert: HighCpuUsage
        expr: node_load1 > 0.85 * on(instance) (node_cpu_seconds_total{mode="idle"}[5m])
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: High CPU usage detected
          description: The 1-minute load average exceeds 85% of available CPU capacity.